# RahtiV2 migration guide

This guide is dedicated to answer te most frequent questions and provide procedures for the RahtiV1 to RahtiV2 migration.

RahtiV1 is the current deployed and used version of OpenShift OKD running in CSC. The exact version is `v3.11`, it is the last released version in the `3.XX` series. RahtiV1 is in open beta, and will never react production status.

RahtiV2 is the next version of OpenShift OKD running in CSC. Due to the fact that OpenShift OKD v4 is a re-implementation, there is no upgrade path provided by the manufacturer for RahtiV1 to become RahtiV2. So in other words, this means that every single application running in RahtiV1 needs to be migrated to RahtiV2 manually. The two versions will run in parallel for a while, till all applications running in v1 are migrated to v2.

## How to log in RahtiV2?

Go to [Rahti4](RAHTI4_URL) and choose the `oidcidp` option, it stands for OpenID Connect identity provider:

![Rahti4 login](img/rahti_login.png){: style="width:400px"}

You will be then served with a page with all the authentication options that Rahti accepts. Choose the one that is more convenient for you, all your identities should be linked to the same Rahti account.

### Command line login 

In order to get the "login command", once you have logged in the web interface, click on your name and then in "Copy Login Command". For security reasons, you will be required to login again, after that you will be served the page the login command you can copy to the clipboard and paste it in any terminal running on your system.

![Copy Login Command](img/CopyLoginCommand.png)

## How to create a project?

There are few places in th web interface where a project can be created. One of the paths to create a project is to go to `Administrator` > `Home` > `Projects`

![page1](img/create_project1.png)

Then click in "Create Project".

![page1](img/create_project2.png)

The fields are the same as with RahtiV1:

1. You need to pick a unique name that is not in use by any other project in the system.
    
1. You can also enter a human-readable display name and.
    
1. You have to also enter a CSC computing project in the Description field. It must be a currently valid CSC project, that your account has access to. In order to view to which CSC projects you have access to, please check https://my.csc.fi. If you have access to no CSC project, you will not be able to create any Rahti project. If you have Rahti access via project_1000123, you would enter the following in the Description field:

> csc_project: XXXXXXX

## How to see quota/limits?

The quota and limits of a given project can be found in the bottom of the project details page 

![Project page](img/project_page.png)

If you click in "quota"

![Quota details](img/quota_details.png)

## How to create routes?

A Route can be created by going to the project details page, and click in Routes.

![Project page](img/project_page2.png)

And then click in "Create Route"

![Create Route](img/create_route.png)

A Route has two compulsory parameters:

* a `name`, which must be unique within the project.
* a `service`/`port`, which is where the traffic will be routed to.  

Other optional parameters are:

* a `hostname`, which must be unique within Rahti. If none is provided, the hostname will be autogenerated by using the route `name` and the `project name`.
* `Secure Route` can be activated to activate TLS encryption. The options are similar than in [RahtiV1 Routes](/cloud/rahti/networking/#routes)

## How to manage users in project?

In the project details page select "Project access".

![Manage users](img/manage_users.png)

You just need to write the user's username, and a role level: `admin`, `Edit` or `View`. To save the changes, just click in `Save`. The different access that each role level has can be checked out in the linked documentation in the page itself.

## How to delete project?

A project can be deleted from the Project details page (`Developer` > `Project`), by selecting `Actions` > `Delete project`. A dialog to confirm the deletion will appear:

![Delete Project](img/delete_project.png)

The name of the project (`app-config` in this example) has to be inputted before the project is deleted. This is just to avoid accidental deletion.

## How to use storage?

In the Project details page (`Developer` > `Project`), click `PersistentVolumeClaims` and then click in `Create PersistentVolumeClaim`.

![Create PersistentVolumeClaim](img/Create_PersistentVolumeClaim.png)

* For the moment only a single type of `StorageClass` can be used. It corresponds to `Cinder` volumes, which can only be read or write by a single Pod.

* A unique name within the project must be provided.

* A size within the quota limits has to be inputted.

* The Volume mode should be `Filesystem`.

Once the volume is created, it can be mounted in a Pod as in `RahtiV1` or any other Kubernetes installation.
