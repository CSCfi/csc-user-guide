[Käyttöoppaan sisällysluettelo :material-arrow-right:](sd-services-toc.md)

# Aineiston toimittaminen { #data-submission }

Alta löydät vaiheittaiset ohjeet biolääketieteellisen datan lataamiseen, kuvaamiseen ja julkaisemiseen Finnish Federated EGA -palvelun (FEGA) kautta. Huomioithan, että prosessi voi olla pitkäkestoinen (noin yhdestä kuuteen kuukautta), mutta tarjoamme tukea ja ohjausta koko prosessin ajan.

Tässä käyttöoppaassa kuvattu prosessi on tarkoitettu nimenomaan aineistojen toimittamiseen Finnish FEGAan. Central EGA ja muut FEGA-solmut käyttävät erilaisia aineistojen toimitusprosesseja.

Toimituspyynnöt käsitellään saapumisjärjestyksessä.

!!! Note
    Ennen kuin aloitat, on tärkeää varmistaa, että Federated EGA -palveluun liittyvä palvelusopimus on voimassa CSC:n (käsittelijä) ja kotiorganisaatiosi (tai rekisterinpitäjän) välillä. Aloita aineiston valmistelu hyvissä ajoin (jo ennen käsikirjoituksen lähettämistä tieteelliseen lehteen) ottamalla yhteyttä [CSC Service Deskiin](../../support/contact.md) (aihe: Federated EGA) sekä kotiorganisaatiosi lakipalveluihin.

## Vaihe 1: Oikeudelliset sopimukset, Data Access Committee ja Policies { #step-1-legal-agreements-data-access-committee-and-policies }

Aineiston tallettaminen Finnish Federated EGAan edellyttää useita oikeudellisia sopimuksia: Federated EGA -palvelusopimus sekä Data Access Agreement -sopimus, joka sisältää Data Transfer Agreementin. Nämä sopimukset sekä aineiston myöhempi käyttöoikeuksien hallinta ovat rekisterinpitäjän vastuulla. Toimitetun datan rekisterinpitäjä on tavallisesti tutkimusta koordinoiva akateeminen organisaatio. Datan omistajuus ei muutu tämän palvelun käytön myötä.

Datan toimittaminen FEGAan kuuluu [CSC:n maksuttomien](https://research.csc.fi/free-of-charge-use-cases) käyttötapausten piiriin suomalaisen akateemisen tutkimuksen osalta, mutta maksuttomuus ei sisällä datan pakollista varmuuskopiota. Varmuuskopiointitila voidaan hankkia FEGA:n lisäpalveluna, tai organisaatio voi sopia varmuuskopion muista säilytystavoista CSC:n kanssa tehtävässä sopimuksessa. Lisätietoa FEGA:n sisäisen varmuuskopiointipalvelun hinnoittelusta löytyy [hinnoitteludokumentista](https://a3s.fi/docs-files/sensitive-data/PDF_instructions/federated-ega-pricing.pdf){ target=_blank }. Toimituspalvelu on käytettävissä vain suomalaisille käyttäjille.

Lisätietoa vaadittavista sopimuksista ja käyttöoikeuksien hallinnasta:

* Palvelusopimus Federated EGAan: organisaatiollasi (tai rekisterinpitäjällä) tulee olla erillinen palvelusopimus CSC:n (käsittelijä) kanssa ennen Finnish Federated EGA -palveluun pääsyä. Tämä palvelusopimus sisältää tietojenkäsittelysopimuksen (DPA), joka määrittelee käsittelyn laajuuden ja tarkoituksen sekä rekisterinpitäjän ja käsittelijän oikeudet ja velvollisuudet. Varmista, että organisaatiollasi on FEGA-palvelusopimus ennen toimitusprosessin aloittamista. Jos sopimusta ei ole, ota yhteyttä [CSC Service Deskiin](../../support/contact.md) (aihe: Federated EGA).

* Data Access Agreement: Data Access Agreement (DAA) on sopimus Data Access Committeen (DAC) ja datan uudelleenkäyttöä hakevan hakijan välillä. DAA:n kautta rekisterinpitäjä voi määritellä datan uudelleenkäytön ehdot ja rajoitteet, mukaan lukien käytön, julkaisun, latauksen ja pääsyn periaatteet. DAA:n tulisi sisältää myös Data Transfer Agreement (DTA), jota tarvitaan, kun EU/ETA-alueen ulkopuoliset tutkijat käyttävät dataa SD Desktopin kautta. DAA ja DTA sisällytetään data access -käytäntöihin (ks. seuraava kappale). Lisätietoja saat kotiorganisaatiosi Data Access Committeelta tai lakipalveluista. Löydät [esimerkkipohjan täältä](https://ega-archive.org/assets/files/Example_DAA.doc).

* Data Access Committee ja Policies: Data Access Committee (DAC) ja Policies hallinnoi rekisterinpitäjä. Datan käyttöoikeudet sekä DAC- ja Policy-tiedot hallitaan erillisessä [SD Apply](./sd-apply.md) -palvelussa. Organisaatioilla voi olla yleiset DAC:t ja Policies, joita käytetään kaikille samasta organisaatiosta toimitetuille aineistoille. Vain datasettiin liittyvä käyttöoikeushakemuksen linkki on datasetti-kohtainen. Linkki luodaan, kun toimitus on viimeistelty FEGA:n lähetysportaalissa ja datasetin yksilöivä tunniste on yhdistetty DAC:iin, Policies-käytäntöihin ja hakemuslomakkeeseen SD Apply:ssa. Varmistaaksesi, että organisaatiollasi on datasetillesi sopivat DAC ja Policies, ota yhteyttä oman organisaatiosi edustajiin tai [CSC Service Deskiin](../../support/contact.md) lisäohjeita varten.

## Vaihe 2: Toimituksen yleiset tiedot { #step-2-general-information-of-the-submission }

Toimitus Finnish Federated EGA -palveluun alkaa ottamalla yhteyttä Finnish FEGA -tukeen ja toimittamalla toimituksen yleiset tiedot. Mieluiten tämä tieto jaetaan ensin organisaation DAC:lle, joka voi sen jälkeen lähettää tiedot FEGA-tukeen omalla hyväksynnällään.

Aloittaaksesi toimitusprosessin, täytä [yleiset tiedot -lomake](https://a3s.fi/docs-files/sensitive-data/PDF_instructions/fega-general-information.pdf), johon merkitään yhteystiedot, tiedot toimituksen tyypistä ja rekisterinpitäjästä, tai toimita samat tiedot sähköpostilla. Lähetä toimituspyyntö organisaatiosi DAC:lle, joka voi toimittaa vaaditut tiedot sähköpostitse [CSC Service Deskiin](../../support/contact.md) (aihe: Federated EGA).

## Vaihe 3: Tunnukset { #step-3-credentials }

Kun rekisterinpitäjän ja CSC:n väliset sopimukset on viimeistelty ja organisaation DAC on hyväksynyt toimituksen, voit rekisteröityä [EGA:n sivuilla](https://ega-archive.org/register/) luodaksesi Central EGA -tunnukset. Saat sähköpostitse aktivointilinkin, kun rekisteröintisi on hyväksytty Centraali-EGA:ssa. Aktivoituasi tunnuksesi, ota yhteyttä [CSC Service Deskiin](../../support/contact.md), jotta sinut lisätään Finnish FEGA -toimittajaksi. Lisäksi ilmoita se IP-osoite, josta siirrät dataa FEGAan, jotta voit muodostaa yhteyden FEGA:n inboxiin.

!!! note
    Central EGA -tunnuksia, eli käyttäjätunnusta (yleensä sähköpostiosoitteesi) ja salasanaa, tarvitaan datan salaukseen ja lataukseen Finnish FEGAan sekä metatietojen toimittamiseen lähettäjäportaalissa.

## Vaihe 4: Datan muodot { #step-4-data-formats }

Ennen datan lataamista FEGAan sinun tulee valmistella datasetit ja varmistaa datamuodot. Alla on joitakin esimerkkejä hyväksytyistä muodoista.

!!! note
    Datasetti määritellään yleensä joukoksi tiedostoja, jotka kuuluvat samaan kokeeseen ja datatyyppiin. Yksi tutkimus voi sisältää useita datasettejä. Tutkimukseesi voi kuulua sekä arkaluonteista (esim. ihmisen geneettinen tai fenotyyppinen tieto) että ei-arkaluonteista dataa (esim. virussekvenssit, metaboliitit). Vain arkaluonteinen data voidaan toimittaa FEGAan. Ei-arkaluonteinen data voidaan julkaista avoimesti sopivissa repositorioissa. Tällöin repositoriossa luodut näyte-ID:t tulisi viitata FEGA-toimituksessa.

### Arkaluonteinen data { #sensitive-data }

* sekvenssidata: CRAM-, BAM-, FASTQ-, VCF-formaatit

* metagenomiikka: EGA on ottanut käyttöön [Minimum Information about any (x) Sequence (MIxS)](https://www.gensc.org/pages/projects/mixs-gsc-project.html) -standardit tämän datatyypin kuvaamiseen.

* fenotyyppinen tieto: Ei erityistä formaattia. Mahdollisuuksien mukaan suosittelemme Experimental Factor Ontologies -ontologioiden käyttöä. Etsi sopivat ontologiatermit ja kuvaa fenotyyppiset tietosi EMBL-EBI:n kehittämän [Ontology Lookup Service (OLS)](https://www.ebi.ac.uk/ols/ontologies/efo) -palvelun avulla.

* linkitystiedostot: Jos samaan tutkimukseen kuuluvia ei-arkaluonteisia datasettejä on toimitettu tiettyyn repositorioon, näytteet voidaan linkittää samaa näytettä koskevaan FEGA:an toimitettuun arkaluonteiseen tietoon. Dataseteillä tulee olla eri anonymisoidut näyte-ID:t kussakin arkistossa. Sopivassa arkistossa saadut ID:t voidaan sitten viitata FEGA-toimituksessa. Esimerkiksi näyte-ID voidaan linkittää erillisessä `.txt`-tiedostossa, joka voidaan liittää johonkin yllä mainituista arkaluonteisista dataseteistä.

!!! note
    FEGA ei tue array-aineistoa. Lue lisää array-pohjaisista toimituksista ja siitä, miten array-pohjaiset datasetit toimitetaan [EGA:n verkkosivulla](https://ega-archive.org/submission/metadata/submission/array/).

### Fenotyyppinen data { #phenotypic-data }

Jotta voit toimittaa arkaluonteista fenotyyppistä dataa FEGAan,

1. valitse fenotyyppiseen dataan sopiva metatietomalli,
2. järjestä data valitun metatietomallin mukaisesti,
3. tallenna tiedot tekstitiedostoon tai muuhun sopivaan formaattiin, ja
4. toimita fenotyyppinen data datasetiksi.

### COVID-19-data { #covid-19-data }

Jos toimitat COVID-19:n fenotyyppistä kliinistä dataa FEGAan, käytä [Bernasconi ym. (2021)](https://doi.org/10.1093/bib/bbaa359) määrittelemää metatietomallia. Tämä edistää tutkimusten välistä yhteentoimivuutta.

### Ei-arkaluonteinen data { #non-sensitive-data }

Ei-arkaluonteinen (tai avoin) data tulee toimittaa tarkoitukseen sopiviin arkistoihin. Esimerkiksi sekvenssit ENA:han [European Nucleotide Archive](https://www.ebi.ac.uk/ena/browser/home), variantit EVA:an [European Variation Archive](https://www.ebi.ac.uk/eva/), array-pohjaiset [ArrayExpress – functional genomics data](https://www.ebi.ac.uk/arrayexpress/), fenotyypit [BioSamples](https://www.ebi.ac.uk/biosamples/) ja GWAS-yhteenvetotilastot [GWAS Catalogiin](https://www.ebi.ac.uk/gwas/).

!!! note
    Lisätietoa datatyypeistä ja -muodoista löydät [EGA:n Submission FAQ -sivulta](https://ega-archive.org/submission/metadata/submission/FAQ/) tai ottamalla yhteyttä [CSC Service Deskiin](../../support/contact.md) (aihe: Federated EGA).

## Vaihe 5: Datan salaus ja lataus { #step-5-data-encryption-and-upload }

Seuraavaksi voit ladata datan Finnish FEGAan. Jokainen Finnish FEGAan ladattava tiedosto on salattava.

!!! note
    - Data salataan GA4GH-standardin (Global Alliance for Genomics and Health) mukaisilla työkaluilla, jotka on suunniteltu ihmisen geneettisen datan salaamiseen ja jakamiseen.
    - Jos sinulla on yhteistyökumppaneita metatietojen toimituksessa, huomioi, että vain tiedostot ladannut käyttäjä näkee ne inboxissa metatietojen toimituksen aikana ja voi toimittaa Run- ja Analysis-metadataa.

Voit suorittaa salauksen ja latauksen käyttäen:

* Vaihtoehto 1 – Fi-FEGA-lataussovellus. Fi-FEGA-lataussovellusta (graafinen käyttöliittymä, GUI) voidaan käyttää tiedostojen tai kansioiden salaamiseen ja automaattiseen lataukseen Finnish FEGAan.

tai

* Vaihtoehto 2 – Komentorivikäyttöliittymä. Datan salaus crypt4gh-CLI:llä ja datan lataus sftp-CLI:llä. Jos haluat käyttää komentoriviä, löydät tiedot salaus- ja latausvaiheista alta.

### Vaihtoehto 1 – Fi-FEGA-lataussovellus { #option-1-fi-fega-upload-application }

1. Voit ladata käyttöjärjestelmäsi mukaisen Fi-FEGA-lataussovelluksen [GitHub-repositorysta](https://github.com/CSCfi/sda-uploader/releases): Linux, Mac tai Windows, valitse sdagui-vaihtoehdoista. Ladattuasi ja purettuasi paketin löydät sovelluksen latauskansiostasi. Kun avaat sovelluksen, saatat kohdata virheilmoituksen. Tällöin klikkaa kohtausta Lisää tietoja (More info), varmista että julkaisija on CSC-IT Center for Science (suomeksi: CSC–Tieteen tietotekniikan keskus Oy) ja valitse Suorita silti (Run anyway).

2. Lataa seuraavaksi [Finnish FEGA:n julkinen salausavain](https://a3s.fi/fega-public-keys/fega-pubkey-c4gh.pub).

3. Avaa lataussovellus ja klikkaa kohtaa Load recipient public key. Tämä avaa tiedostoselaimen, josta voit valita Finnish FEGA:n julkisen salausavaimen (`fega-pubkey-c4gh.pub`). Klikkaa sitten Open.

4. Klikkaa Select file to upload tai Select directory to upload ladataksesi yksittäisen tiedoston tai kokonaisen kansion.

5. Seuraavaksi täytä SFTP- (eli suojatun yhteyden) tunnukset, jotka vastaavat Central EGA -tilisi käyttäjätunnusta. Kirjoita SFTP Username -kenttään EGA-käyttäjätunnuksesi (yleensä sähköpostiosoitteesi). Kirjoita SFTP Server -kenttään: `admin.sd.csc.fi:50529`. SFTP-avainta ei tarvitse ladata FEGA-latauksia varten.

6. Klikkaa Encrypt and upload files. Työkalu pyytää SFTP-salasanaa, joka on Central EGA -tilisi salasana. Klikattuasi OK sovellus aloittaa datan salauksen ja latauksen.

7. Sovelluksessa ei ole edistymispalkkia. Datan salaus ja lataus voivat kestää minuuteista useisiin tunteihin datasetin koosta riippuen. Lataus on onnistuneesti valmis, kun sovelluksen lokissa näkyy viesti: `Disconnecting SFTP. SFTP has been disconnected.` Kun prosessi on valmis, näet tiedostot [lähettäjäportaalissa](https://submission.finland.ega-archive.org/) menemällä Files-sivulle oikean yläkulman valikosta.

[![Fi-FEGA-lataussovellus](images/fega/fega_upload.png)](images/fega/fega_upload.png)

### Vaihtoehto 2 – Komentorivikäyttöliittymä { #option-2-command-line-interface }

Datan salaus crypt4gh-CLI:llä:

1. Python 3.6+ vaaditaan Crypt4GH-salaustyökalun käyttöön. Jos tarvitset apua Pythonin asennuksessa, noudata [näitä ohjeita](https://www.python.org/downloads/release/python-3810/).

2. Avaa pääte (terminal) ja asenna Crypt4GH suoraan pip-työkalulla:

    ```bash
    pip install crypt4gh
    ```

3. Salaa tiedosto käyttäen [Finnish FEGA:n julkista salausavainta](https://a3s.fi/fega-public-keys/fega-pubkey-c4gh.pub) komennolla ```crypt4gh encrypt```:

    ```bash
    crypt4gh encrypt  --recipient_pk fega-pubkey-c4gh.pub < example_file.txt > example_file.txt.c4gh
    ```

    Tässä `--recipient_pk` määrittelee salaukseen käytettävän julkisen avaimen (tässä Finnish FEGA:n avain). `example_file.txt` on syötetiedosto ja `example_file.txt.c4gh` on salattu tulostiedosto.

Datan lataus SFTP-CLI:llä (oletuksena Linuxissa ja macOS:ssä):

1. Avaa pääte ja muodosta SFTP-yhteys seuraavalla komennolla, jossa `ega_user` on EGA-tunnuksesi käyttäjänimi (yleensä sähköpostiosoitteesi):

    ```bash
    sftp -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -P 50529 ega_user@admin.sd.csc.fi
    ```

    Salasanaksi käytä Central EGA -tilisi salasanaa.

2. Siirrä salatut tiedostot tai kansio komennolla put, kun olet yhteydessä sftp:hen.

    ```bash
    sftp> put example_file.txt.c4gh
    ```

    Lataus voi kestää minuuteista useisiin tunteihin datasetin koosta riippuen.

3. Odota prosessin valmistumista ennen yhteyden sulkemista. Kun prosessi on valmis, sinun pitäisi nähdä tiedostot [lähettäjäportaalissa](https://submission.finland.ega-archive.org/) menemällä Files-sivulle oikean yläkulman valikosta. Kun olet varmistanut, että prosessi on päättynyt, voit sulkea SFTP-yhteyden komennolla `exit`. On tärkeää katkaista yhteys, kun lataus on valmis.

## Vaihe 6: Metatietojen toimittaminen { #step-6-metadata-submission }

Seuraavaksi voit kuvata tutkimukseesi liittyvät tiedot, eli ei-arkaluonteiset julkiset metatiedot, käyttämällä [Finnish FEGA -lähettäjäportaalia](https://submission.finland.ega-archive.org/). Julkiset metatiedot julkaistaan EGA:n verkkosivulla, jotta datan löydettävyys ja uudelleenkäyttö helpottuvat.

Voit tutustua lähettäjäportaaliin alla olevasta videosta tai ottamalla käyttöön portaalin opastuskierroksen klikkaamalla keltaista kirjakuvaketta oikeassa yläkulmassa, kun olet kirjautuneena sisään.

<iframe width="280" height="155" srcdoc="https://www.youtube.com/embed/eDTNIE8Ex0g?si=QJlYwfAGERAHN-e9" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

Kirjaudu lähettäjäportaaliin EGA-tunnuksillasi (käyttäjätunnus: yleensä sähköpostiosoitteesi, ja salasana).

Lähettäjäportaalissa voit rekisteröidä seuraavat metatieto-objektit:

* Study. Tiedot sekvensointitutkimuksesta. Otsikon tulisi olla 3–20 sanan pituinen johdanto projektiin, ja kuvauksen 3–5 virkettä, jotka määrittelevät projektin taustan, tavoitteen ja yksityiskohtia. Studyn metatiedot ovat julkisesti saatavilla EGA:n verkkosivulla.

* Samples. Tiedot kokeen tai analyysin sekvensointinäytteistä. Voit tehdä myös näytteiden eräsiirron. Samples-matatiedot voivat olla tunnistettavia, ja siksi ne ovat vain valtuutettujen datan hakijoiden saatavilla, poikkeuksena alias, title, subject_id, gender ja phenotype. On toimittajan vastuulla, ettei näihin julkisiin kenttiin lähetetä arkaluonteisia metatietoja. Lisäksi anonymisoidut kentät, jotka yksilöivät näytteen arkistoissa – näytteen EGA-stabiili ID (EGAN…), BioSample ID (SAMEA…) ja toimittajan center name – ovat julkisesti nähtävissä EGA:n verkkosivulla.

* Experiments. Tiedot sekvensointimenetelmistä, -protokollista ja -laitteista. Experiments-matatiedot ovat julkisesti saatavilla EGA:n verkkosivulla.

* Runs. Tiedot tiedostoista, jotka sisältävät ajon aikana tuotetun raakadatan. Samples-, experiments- ja files-objektit linkittyvät Runs-objektien kautta. Sopiva objekti FASTQ- ja BAM/CRAM-toimituksille. Voit tehdä myös runien eräsiirron. Runs-metatiedot ovat julkisesti saatavilla EGA:n verkkosivulla.

* Analysis. Viittaukset analyysitiedostoihin, jotka voivat sisältää käsiteltyä dataa (VCF), tietyn tyyppistä raakadataa (BAM/BAI tai CRAM/CRAI) tai fenotyyppistä tietoa. Liitetään Samples- ja Study-objekteihin. Analysis on EGA-spesifinen metatieto-objekti, joka liittää Samples-objektit Files-objekteihin. Jos sinulla ei ole analyysitiedostoja, voit edetä ilman Analysis-metatietoja. Analysis-metatiedot ovat julkisesti saatavilla EGA:n verkkosivulla.

* Dataset. Sisältää kokoelman datatiedostoja, jotka on organisoitu Runs- ja/tai Analysis-objektien alle ja joiden käyttö on kontrolloitua. Liitetään Policy-objektiin, joka sisältää käyttöoikeushakemuksen linkin ja jonka CSC helpdesk luo. Otsikon tulisi olla 3–20 sanan mittainen katsaus datasetin sisältöön, ja kuvauksen 3–4 virkettä, joissa määritellään datasetin sisältö, mukaan lukien näytteiden lukumäärä ja yksityiskohdat, tiedostotyyppi ja käytetty teknologia/menetelmä. Dataset-metatiedot ovat julkisesti saatavilla EGA:n verkkosivulla.

Kun olet täyttänyt kaikki metatiedot, voit viimeistellä toimituksen, jolloin se siirtyy Finnish FEGA -tukeen hyväksyntää ja julkaisua varten. Datan julkaisun jälkeen kullekin objektille annetaan pysyvä tunniste eli yksilöllinen accession-numero.

!!! note
    * Dataset-kohtainen Policy-kohde metatietoja varten täytyy luoda erikseen CSC:n helpdeskin toimesta ennen kuin sen voi valita lähettäjäportaalissa. Tämä Policy-metatietokohde liittää datasetin organisaatiosi SD Apply:ssa luomaan data access -hakemukseen (ks. [Vaihe 1](./fega-submission.md#step-1-legal-agreements-data-access-committee-and-policies)).
    * Study-, Samples- ja Experiment-metatiedot voidaan rekisteröidä ennen tiedostojen lataamista, kun taas Run- ja Analysis-objekteja ei voi rekisteröidä ennen kuin tiedostot on ladattu Finnish FEGAan. Voit valita Policy-kohteen toimituksellesi vasta sen jälkeen, kun olet rekisteröinyt kaikki muut metatiedot, samalla kun rekisteröit Dataset-metatiedot.

## Vaihe 7: Datan julkaisu { #step-7-data-release }

Saat hyväksynnän ja julkaisun etenemään lähettämällä viestin [CSC Service Deskiin](../../support/contact.md) ja vahvistamalla, että toimitus voidaan julkaista.

CSC:n helpdesk viimeistelee julkaisuprosessin. Saat vahvistuksen onnistuneesta toimituksesta sekä julkaisuun, apurahahakemuksiin jne. soveltuvat accession-tunnisteet CSC:n helpdeskiltä.

!!! note
    Jos joku haluaa hakea pääsyä Finnish FEGA:ssa säilytettävään datasettiisi, hänen tulee klikata datasetin hakemuslinkkiä EGA:n verkkosivulla. Linkki ohjaa käyttäjän SD Apply -palvelun hakemuslomakkeeseen. SD Apply on palvelu, jossa haetaan ja hallitaan käyttöoikeuksia CSC:llä säilytettäviin arkaluonteisiin datasetteihin. Datan käyttöoikeuden hakemiseen on erillinen [ohje](./sd-apply-access.md).