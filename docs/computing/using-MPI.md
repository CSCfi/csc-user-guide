# Using MPI

MPI (Message Passing Interface) is a standard specification for message passing libraries. It allows portable parallel programs in Fortran and C/C++. MPI has become a de facto standard for communication among processes that create a parallel application running on a distributed memory system. MPI is suitable for both distributed memory computers and shared memory architectures. In MPI, each task has an address space in memory that other tasks cannot directly access. When exchange of data is needed between tasks, the tasks send 'messages' to each other.

## Compiling and linking MPI programs

IntelMPI and OpenMPI (= hpcx-mpi) are available. Systems might have many installed releases and they can be listed this way:

```
module spider intel-mpi
module spider hpcx-mpi
```
Before selecting a MPI release an Intel or a Gnu compiler release must be selected. When a compiler and MPI library
has been loaded there are MPI compiler wrappers for compiling Fortran, C and C++ MPI programs.

The Intel compiler wrappers for MPI libraries.

| language  | hpcx-mpi wrapper <br/>(Intel compiler + OpenMPI library)| IntelMPI wrapper <br/>(Intel compiler + IntelMPI library) | 
| :------------- |:-------------| :-----|
| Fortran   | mpifort  | mpiifort |
| C         | mpicc    | mpiicc |
| C++       | mpic++   | mpiicpc |

The Gnu compiler wrappers for MPI libraries.

| language  | hpcx-mpi wrapper <br/>(Gnu compiler + OpenMPI library) | IntelMPI wrapper  <br/>(Gnu compiler + IntelMPI library) | 
| :------------- |:-------------| :-----|
| Fortran   | mpifort  | mpif90 |
| C         | mpicc    | mpigcc |
| C++       | mpic++   | mpigxx |

These wrappers take care of compiler and linker directives for compiling MPI programs. Users do not need to specify include file locations, MPI libraries or their locations.

For example, a MPI program (one source code file) written with the Fortran language ('my_mpi_prog.f95') is compiled and linked as (Intel Fortran Compiler + IntelMPI library):

```
mpiifort my_mpi_prog.f95 -o my_mpi_prog
```

To compile each of the source code files separately use *-c* flag. The example below will generate the object code files my_mpi_source1.o and my_mpi_source2.o.

```
mpiifort -c my_mpi_source1.f95
mpiifort -c my_mpi_source2.f95
```
These can be linked to an executable program (my_mpi_prog)

```
mpiifort my_mpi_source1.o my_mpi_source2.o -o my_mpi_prog
```
The **-show** option displays the actual compilation/linking command generated by the wrapper. For example, try:
```
mpiifort -show
```

## Include files
In order to use MPI calls in a program code,  one of the following lines has to be included in a source code.
For programs written in Fortran 77 use:
```
	include 'mpif.h'
```
and for Fortran 90 or newer use:
```
	use mpi
```
For MPI Fortran 2008:
```
	use mpi_f08
```
For programs written in C/C++ use:

```
    #include "mpi.h"
```

## Links to original MPI library documentation

[Intel MPI Developer Guide](https://software.intel.com/en-us/mpi-developer-guide-linux)

[Intel MPI Developer Reference](https://software.intel.com/en-us/mpi-developer-reference-linux)

[Open MPI site](https://www.open-mpi.org)

